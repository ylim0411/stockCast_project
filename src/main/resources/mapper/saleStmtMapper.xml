<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="SaleStmt">
    <!-- 거래명세서 목록 표시 ho -->
    <select id="findAll" resultType="saleList">
        SELECT * FROM erp_db.order_category_view
        WHERE status = "완료";
    </select>
    <!-- 발주번호와 일치하는 거래명세서 내역 가져오기 ho -->
    <select id="findBySaleId" parameterType="int" resultType="AccoList">
        SELECT o.orderId, o.orderDate, p.productName, s.purchaseQty, s.purchasePrice FROM  orderStmt o
        JOIN purchaseOrder s ON s.orderId = o.orderId
        JOIN product p ON s.productId = p.productId
        WHERE o.orderId = ${id}
    </select>
    <!-- 목록 수(페이징) ho -->
    <select id="saleCount" resultType="int">
        SELECT COUNT(DISTINCT os.orderId)
        FROM orderStmt os
        JOIN purchaseOrder po ON os.orderId = po.orderId
        WHERE os.status ="완료";
    </select>
    <!-- 발주번호 검색 + 페이징 ho -->
    <select id="findByNoPaging" parameterType="map" resultType="saleList">
        <![CDATA[
        SELECT * FROM erp_db.order_category_view
        WHERE
        orderId LIKE CONCAT('%', #{orderNumber}, '%')
        AND status = '완료'
        LIMIT #{start}, #{limit};
        ]]>
    </select>
    <!--  총 개수  -->
    <select id="countByDate" parameterType="map" resultType="int">
        <![CDATA[
        SELECT COUNT(DISTINCT os.orderId)
        FROM orderStmt os
        WHERE os.orderDate >= #{startDate}
        AND os.orderDate < #{endDate}
        AND os.status = "완료"
        ]]>
    </select>
    <!--  총 개수  -->
    <select id="countByNo" parameterType="string" resultType="int">
        SELECT COUNT(DISTINCT os.orderId)
        FROM orderStmt os
        WHERE os.orderId LIKE CONCAT('%', #{orderNumber}, '%')
        AND os.status = "완료"
    </select>
    <!-- 달력 검색 + 페이징 -->
    <select id="findByDatePaging" parameterType="map" resultType="saleList">
        <![CDATA[
       SELECT * FROM erp_db.order_category_view
        WHERE orderDate >= #{startDate}
          AND orderDate < #{endDate} AND status = '완료'
        LIMIT #{start}, #{limit}
        ]]>
    </select>
    <!--  페이징 전체 조회  -->
    <select id="pagingList" parameterType="map" resultType="saleList">
        <![CDATA[
        SELECT * FROM erp_db.order_category_view
        WHERE status = '완료'
        LIMIT #{start}, #{limit}
        ]]>
    </select>
</mapper>