<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="SaleStmt">
    <!-- 거래명세서 목록 표시 ho -->
    <select id="findAll" resultType="saleList">
        SELECT o.orderId, o.orderdate, c.clientName, p.productName, SUM(s.purchasePrice*s.purchaseQty)*1.1 price FROM orderStmt o
        JOIN purchaseOrder s ON s.orderId = o.orderId
        JOIN client c ON c.clientId = o.clientId
        JOIN client_product cp ON cp.clientId = c.clientId
        JOIN product p ON cp.productId = p.productId
        WHERE o.status = "완료"
        GROUP BY o.orderId, o.orderdate, c.clientName, p.productName
        ORDER BY o.orderId;
    </select>
    <!-- 날짜 범위안에 있는 거래명세서 목록 표시 ho -->
    <select id="findByDateBetween" resultType="saleList">
        SELECT o.orderId, o.orderdate, c.clientName, p.productName, SUM(s.purchasePrice*s.purchaseQty)*1.1 price FROM orderStmt o
        JOIN purchaseOrder s ON s.orderId = o.orderId
        JOIN client c ON c.clientId = o.clientId
        JOIN client_product cp ON cp.clientId = c.clientId
        JOIN product p ON cp.productId = p.productId
        WHERE o.status = "완료" AND o.orderDate BETWEEN #{startDate} AND #{endDate}
        GROUP BY o.orderId, o.orderdate, c.clientName, p.productName
        ORDER BY o.orderId;
    </select>
    <!-- 발주번호 일치하는 거래명세서 조회 ho -->
    <select id="findByNo" parameterType="String" resultType="saleList">
        SELECT o.orderId, o.orderdate, c.clientName, p.productName, SUM(s.purchasePrice*s.purchaseQty)*1.1 price FROM orderStmt o
        JOIN purchaseOrder s ON s.orderId = o.orderId
        JOIN client c ON c.clientId = o.clientId
        JOIN client_product cp ON cp.clientId = c.clientId
        JOIN product p ON cp.productId = p.productId
        WHERE o.status = "완료" AND o.orderId = #{orderNumber}
        GROUP BY o.orderId, o.orderdate, c.clientName, p.productName
        ORDER BY o.orderId;
    </select>
</mapper>